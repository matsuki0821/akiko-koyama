---
import { getCollection } from 'astro:content';

const items = await getCollection('testimonials');

const initials = (name: string) =>
  name.trim().split(/\s+/).map((p) => p[0]).join('').slice(0, 2).toUpperCase();
---
<section class="section pt-0 pb-16">

  <div class="masonry mt-4">
    {items.map((t) => (
      <article class="mb-6 break-inside-avoid rounded-2xl border border-black/10 bg-white p-6 shadow-card transition hover:-translate-y-0.5">
        <blockquote class="text-[15px] leading-7 text-base-900/90">“{t.data.quote}”</blockquote>

        <footer class="mt-5 flex items-center gap-3">
          {t.data.avatar ? (
            <img src={t.data.avatar} alt="" class="h-9 w-9 rounded-full object-cover" loading="lazy" decoding="async" />
          ) : (
            <div class="grid h-9 w-9 place-items-center shrink-0 rounded-full bg-black/5 text-xs font-semibold text-base-900/70">
              {initials(t.data.name)}
            </div>
          )}
          <div class="min-w-0">
            <div class="truncate font-medium text-base-900">{t.data.name}</div>
            {t.data.affiliation && <div class="truncate text-sm text-base-900/60">{t.data.affiliation}</div>}
          </div>
        </footer>
      </article>
    ))}
  </div>

  <div class="mt-6 text-center">
    <a href="/reviews" class="btn-cta">受講者の声</a>
  </div>
</section>


